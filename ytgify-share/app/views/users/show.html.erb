<%# User Profile Page - Single-column layout %>
<%# Reference: /mockups/profile.html %>

<main class="pt-16 pb-20 lg:pb-8 min-h-screen">
  <div class="max-w-3xl mx-auto px-4">

    <!-- Profile Header -->
    <div class="py-8 border-b border-gray-800">
      <div class="flex flex-col md:flex-row items-center md:items-start space-y-4 md:space-y-0 md:space-x-6">
        <!-- Avatar -->
        <div class="w-24 h-24 md:w-32 md:h-32 bg-gradient-to-r from-[#E91E8C] to-[#7B2FBE] rounded-full flex items-center justify-center text-4xl md:text-5xl font-bold flex-shrink-0">
          <%= @user.username.first.upcase %>
        </div>

        <!-- Info -->
        <div class="flex-1 text-center md:text-left">
          <div class="flex flex-col md:flex-row md:items-center md:space-x-4 mb-3">
            <h1 class="text-2xl font-bold"><%= @user.display_name || @user.username %></h1>
            <div class="flex items-center justify-center md:justify-start space-x-2 mt-2 md:mt-0">
              <% if user_signed_in? %>
                <% if current_user == @user %>
                  <!-- Own profile - Edit button -->
                  <%= link_to edit_user_registration_path, class: "px-6 py-2 bg-gray-800 hover:bg-gray-700 rounded-full text-sm font-medium transition" do %>
                    Edit Profile
                  <% end %>
                <% else %>
                  <!-- Other user - Follow button -->
                  <div id="follow_button_<%= @user.id %>">
                    <% if current_user.following?(@user) %>
                      <%= button_to follow_user_path(@user.username),
                          method: :post,
                          class: "px-6 py-2 border border-gray-600 text-gray-400 rounded-full text-sm font-medium hover:bg-gray-800 transition" do %>
                        Following
                      <% end %>
                    <% else %>
                      <%= button_to follow_user_path(@user.username),
                          method: :post,
                          class: "px-6 py-2 bg-gradient-to-r from-[#E91E8C] to-[#7B2FBE] rounded-full text-sm font-medium hover:opacity-90 transition" do %>
                        Follow
                      <% end %>
                    <% end %>
                  </div>
                <% end %>
              <% else %>
                <%= link_to new_user_session_path, class: "px-6 py-2 bg-gradient-to-r from-[#E91E8C] to-[#7B2FBE] rounded-full text-sm font-medium hover:opacity-90 transition" do %>
                  Follow
                <% end %>
              <% end %>

              <!-- More Options -->
              <div class="relative" data-controller="dropdown">
                <button data-action="click->dropdown#toggle" class="p-2 bg-gray-800 hover:bg-gray-700 rounded-full transition">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
                  </svg>
                </button>
                <div data-dropdown-target="menu" class="hidden absolute right-0 mt-2 w-48 bg-gray-900 rounded-lg shadow-lg border border-gray-700 py-1 z-10">
                  <button
                    data-controller="share"
                    data-share-url-value="<%= user_url(@user.username) %>"
                    data-share-title-value="<%= @user.display_name || @user.username %> on YTgify"
                    data-action="click->share#share click->dropdown#toggle"
                    class="w-full text-left px-4 py-2 text-sm text-gray-400 hover:bg-gray-800 hover:text-white">
                    Share Profile
                  </button>
                  <% if user_signed_in? && current_user != @user %>
                    <button class="w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-900/30">
                      Report User
                    </button>
                  <% end %>
                </div>
              </div>
            </div>
          </div>

          <!-- Bio -->
          <% if @user.bio.present? %>
            <p class="text-gray-400 mb-4 max-w-md"><%= @user.bio %></p>
          <% end %>

          <!-- Stats -->
          <div class="flex items-center justify-center md:justify-start space-x-6">
            <div class="text-center">
              <span class="font-bold"><%= number_with_delimiter(@user.gifs.not_deleted.count) %></span>
              <span class="text-gray-500 ml-1">GIFs</span>
            </div>
            <%= link_to user_path(@user.username, tab: 'followers'),
                data: { turbo_frame: "profile_content" },
                class: "text-center hover:text-[#E91E8C] transition" do %>
              <span class="font-bold"><%= number_to_human(@user.follower_count || 0, precision: 1, significant: false, format: '%n%u', units: { thousand: 'k', million: 'M' }) %></span>
              <span class="text-gray-500 ml-1">Followers</span>
            <% end %>
            <%= link_to user_path(@user.username, tab: 'following'),
                data: { turbo_frame: "profile_content" },
                class: "text-center hover:text-[#E91E8C] transition" do %>
              <span class="font-bold"><%= number_to_human(@user.following_count || 0, precision: 1, significant: false, format: '%n%u', units: { thousand: 'k', million: 'M' }) %></span>
              <span class="text-gray-500 ml-1">Following</span>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs - Sticky below navbar -->
    <div class="sticky top-16 bg-[#0a0a0a] z-40 border-b border-gray-800">
      <div class="flex">
        <%= link_to user_path(@user.username, tab: 'gifs'),
            data: { turbo_frame: "profile_content" },
            class: "flex-1 py-4 text-center font-medium border-b-2 transition #{@tab == 'gifs' ? 'border-[#E91E8C] text-[#E91E8C]' : 'border-transparent text-gray-400 hover:text-white'}" do %>
          GIFs
        <% end %>
        <%= link_to user_path(@user.username, tab: 'liked'),
            data: { turbo_frame: "profile_content" },
            class: "flex-1 py-4 text-center font-medium border-b-2 transition #{@tab == 'liked' ? 'border-[#E91E8C] text-[#E91E8C]' : 'border-transparent text-gray-400 hover:text-white'}" do %>
          Liked
        <% end %>
        <%= link_to user_path(@user.username, tab: 'collections'),
            data: { turbo_frame: "profile_content" },
            class: "flex-1 py-4 text-center font-medium border-b-2 transition #{@tab == 'collections' ? 'border-[#E91E8C] text-[#E91E8C]' : 'border-transparent text-gray-400 hover:text-white'}" do %>
          Collections
        <% end %>
      </div>
    </div>

    <!-- Tab Content -->
    <%= turbo_frame_tag "profile_content" do %>
      <div class="py-6">
        <%= render "users/tabs/#{@tab}",
                   user: @user,
                   gifs: @gifs,
                   collections: @collections,
                   followers: @followers,
                   following: @following,
                   pagy: @pagy %>
      </div>
    <% end %>
  </div>
</main>

<!-- Mobile Bottom Navigation -->
<%= render "shared/mobile_bottom_nav" %>
